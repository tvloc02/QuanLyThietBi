<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Danh sách người dùng - BaoTriStack</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/dashboard.css">

    <style>
        .user-management-container {
            padding: 30px 40px;
            background: var(--gray-50);
        }

        .page-header {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            border: 1px solid var(--gray-100);
        }

        .page-title {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--gray-800);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .page-subtitle {
            color: var(--gray-600);
            font-size: 1rem;
            margin-bottom: 0;
        }

        .search-filter-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            border: 1px solid var(--gray-100);
        }

        .search-box {
            position: relative;
        }

        .search-box input {
            border-radius: 10px;
            border: 2px solid var(--gray-100);
            padding: 12px 50px 12px 20px;
            font-size: 1rem;
            transition: all 0.3s ease;
            width: 100%;
        }

        .search-box input:focus {
            border-color: var(--primary-blue);
            box-shadow: 0 0 0 3px rgba(30, 64, 175, 0.1);
        }

        .search-box .search-icon {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray-600);
            font-size: 1.2rem;
        }

        .filter-section {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .filter-select {
            border-radius: 10px;
            border: 2px solid var(--gray-100);
            padding: 10px 15px;
            min-width: 150px;
        }

        .users-table-container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            border: 1px solid var(--gray-100);
            overflow: hidden;
        }

        .table-header {
            background: var(--gradient-primary);
            color: white;
            padding: 20px 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .table-title {
            font-size: 1.3rem;
            font-weight: 600;
            margin: 0;
        }

        .users-table {
            width: 100%;
            margin: 0;
        }

        .users-table thead th {
            background: var(--gray-50);
            border: none;
            padding: 15px;
            font-weight: 600;
            color: var(--gray-800);
            border-bottom: 2px solid var(--gray-100);
        }

        .users-table tbody td {
            padding: 15px;
            border-bottom: 1px solid var(--gray-100);
            vertical-align: middle;
        }

        .users-table tbody tr:hover {
            background: var(--gray-50);
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary-blue);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .user-name {
            font-weight: 600;
            color: var(--gray-800);
            margin-bottom: 2px;
        }

        .user-username {
            font-size: 0.9rem;
            color: var(--gray-600);
        }

        .status-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-active {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success-green);
            border: 1px solid rgba(16, 185, 129, 0.2);
        }

        .status-inactive {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger-red);
            border: 1px solid rgba(239, 68, 68, 0.2);
        }

        .status-locked {
            background: rgba(245, 158, 11, 0.1);
            color: var(--warning-orange);
            border: 1px solid rgba(245, 158, 11, 0.2);
        }

        .role-badges {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
        }

        .role-badge {
            background: rgba(30, 64, 175, 0.1);
            color: var(--primary-blue);
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 500;
            border: 1px solid rgba(30, 64, 175, 0.2);
        }

        .navbar-custom {
            background: var(--primary-blue);
            padding: 20px 40px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .navbar-custom .navbar-nav {
            display: inline-flex;
            justify-content: center;
            margin: 0 auto;
        }

        .navbar-custom .nav-link {
            color: white;
            font-size: 1.3rem;
            font-weight: 600;
            padding: 15px 30px;
            border-radius: 10px;
            transition: all 0.3s ease;
            margin: 0 15px;
        }

        .navbar-custom .nav-link:hover,
        .navbar-custom .nav-link.active {
            color: var(--primary-blue);
            background: white;
            transform: translateY(-2px);
        }

        .navbar-custom .dropdown-menu {
            border-radius: 8px;
            border: 1px solid var(--gray-100);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            padding: 10px;
            background: white;
        }

        .navbar-custom .dropdown-item {
            font-size: 1.1rem;
            padding: 12px 15px;
            border-radius: 6px;
            transition: background 0.2s ease, color 0.2s ease;
        }

        .navbar-custom .dropdown-item:hover {
            background: var(--gray-100);
            color: var(--primary-blue);
        }


        .action-buttons {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .action-btn {
            width: 35px;
            height: 35px;
            border-radius: 8px;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .action-btn.view {
            background: rgba(59, 130, 246, 0.1);
            color: #3b82f6;
        }

        .action-btn.edit {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success-green);
        }

        .action-btn.delete {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger-red);
        }

        .action-btn.lock {
            background: rgba(245, 158, 11, 0.1);
            color: var(--warning-orange);
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        .pagination-container {
            padding: 20px 25px;
            background: var(--gray-50);
            border-top: 1px solid var(--gray-100);
        }

        .pagination-info {
            color: var(--gray-600);
            font-size: 0.9rem;
        }

        .btn-primary-custom {
            background: var(--gradient-primary);
            border: none;
            border-radius: 10px;
            padding: 12px 24px;
            font-weight: 600;
            color: white;
            transition: all 0.3s ease;
        }

        .btn-primary-custom:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 15px rgba(30, 64, 175, 0.3);
        }

        .stats-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stats-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            border: 1px solid var(--gray-100);
            text-align: center;
        }

        .stats-number {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary-blue);
            margin-bottom: 5px;
        }

        .stats-label {
            color: var(--gray-600);
            font-size: 0.9rem;
            font-weight: 500;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--gray-600);
        }

        .empty-state i {
            font-size: 4rem;
            :root {
                --gray-400: #9ca3af;
            }
            margin-bottom: 20px;
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(30, 64, 175, 0.3);
            border-top-color: var(--primary-blue);
            border-radius: 50%;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .user-management-container {
                padding: 20px;
            }

            .filter-section {
                flex-direction: column;
                align-items: stretch;
            }

            .filter-select {
                min-width: auto;
            }

            .users-table-container {
                overflow-x: auto;
            }

            .users-table {
                min-width: 800px;
            }

            .action-buttons {
                flex-direction: column;
                gap: 5px;
            }
        }
    </style>
</head>
<body>
<div class="main-container">
    <!-- Header Section (giữ nguyên như dashboard) -->
    <div class="header">
        <div class="header-title">
            <i class="fas fa-cog"></i>
            QUẢN LÝ THIẾT BỊ TRƯỜNG HỌC
        </div>
        <div class="search-bar">
            <input type="text" placeholder="Tìm kiếm..." class="form-control">
        </div>
        <div class="user-info">
            <div class="user-avatar" data-bs-toggle="dropdown" aria-expanded="false">
                <i class="fas fa-user"></i>
            </div>
            <div class="dropdown">
                <div class="account-dropdown dropdown-menu dropdown-menu-end">
                    <div class="account-dropdown-item">
                        <i class="fas fa-user me-2"></i>
                        <span>Admin User</span>
                    </div>
                    <div class="account-dropdown-item">
                        <i class="fas fa-shield-alt me-2"></i>
                        <span>Quản trị viên</span>
                    </div>
                    <div class="account-dropdown-item">
                        <i class="fas fa-envelope me-2"></i>
                        <span>admin@truonghoc.edu.vn</span>
                    </div>
                    <div class="account-dropdown-item">
                        <i class="fas fa-clock me-2"></i>
                        <span>Đăng nhập gần nhất: 30/07/2025 14:00</span>
                    </div>
                    <hr class="my-2">
                    <a href="/tai-khoan/chinh-sua" class="account-dropdown-item">
                        <i class="fas fa-user-edit me-2"></i> Chỉnh sửa hồ sơ
                    </a>
                    <a href="/logout" class="account-dropdown-item text-danger">
                        <i class="fas fa-sign-out-alt me-2"></i> Đăng xuất
                    </a>
                </div>
            </div>
            <div>
                <div style="font-weight: 600; margin-bottom: 4px;">Admin User</div>
                <div style="opacity: 0.8; font-size: 0.9rem;">Quản trị viên</div>
                <div style="opacity: 0.7; font-size: 0.8rem;">
                    <i class="fas fa-clock me-1"></i>
                    <span>00:56 30/07/2025</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Horizontal Navigation Menu (giữ nguyên như dashboard) -->
    <nav class="navbar navbar-expand-lg navbar-custom">
        <div class="container-fluid">
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="/dashboard">Dashboard</a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle active" href="#" role="button" data-bs-toggle="dropdown">
                            Người dùng
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item active" href="/nguoi-dung/danh-sach-nguoi-dung">Danh sách người dùng</a></li>
                            <li><a class="dropdown-item" href="/nguoi-dung/them-nguoi-dung">Thêm người dùng</a></li>
                            <li><a class="dropdown-item" href="/nguoi-dung/vai-tro">Quản lý vai trò</a></li>
                            <li><a class="dropdown-item" href="/nguoi-dung/quyen">Quản lý quyền</a></li>
                            <li><a class="dropdown-item" href="/nguoi-dung/duyet-yeu-cau">Duyệt yêu cầu</a></li>
                        </ul>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/thiet-bi">Thiết bị</a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                            Vật tư
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="/vat-tu/quan-ly-kho">Quản lý kho</a></li>
                            <li><a class="dropdown-item" href="/vat-tu/thieu-hang">Vật tư thiếu hàng</a></li>
                            <li><a class="dropdown-item" href="/vat-tu/het-han">Vật tư hết hạn</a></li>
                        </ul>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                            Bảo trì
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="/bao-tri/yeu-cau">Yêu cầu bảo trì</a></li>
                            <li><a class="dropdown-item" href="/bao-tri/ke-hoach">Kế hoạch bảo trì</a></li>
                            <li><a class="dropdown-item" href="/bao-tri/lich-su">Lịch sử bảo trì</a></li>
                        </ul>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                            Báo cáo
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="/bao-cao/tong-hop">Báo cáo tổng hợp</a></li>
                            <li><a class="dropdown-item" href="/bao-cao/thong-ke">Thống kê</a></li>
                        </ul>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            Trợ giúp
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="/tro-giup/huong-dan-su-dung">Hướng dẫn sử dụng</a></li>
                            <li><a class="dropdown-item" href="/tro-giup/video-huong-dan">Video hướng dẫn</a></li>
                            <li><a class="dropdown-item" href="/tro-giup/cau-hoi-thuong-gap">Câu hỏi thường gặp</a></li>
                            <li><a class="dropdown-item" href="/tro-giup/lien-he-ho-tro">Liên hệ hỗ trợ</a></li>
                            <li><a class="dropdown-item" href="/tro-giup/ve-he-thong">Về hệ thống</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- User Management Content -->
    <div class="user-management-container">
        <!-- Page Header -->
        <div class="page-header">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h1 class="page-title">
                        <i class="fas fa-users text-primary"></i>
                        Danh sách người dùng
                    </h1>
                    <p class="page-subtitle">Quản lý tài khoản người dùng trong hệ thống</p>
                </div>
                <div>
                    <a href="/nguoi-dung/them-nguoi-dung" class="btn btn-primary-custom">
                        <i class="fas fa-user-plus me-2"></i>
                        Thêm người dùng
                    </a>
                </div>
            </div>
        </div>

        <!-- Statistics Cards -->
        <div class="stats-cards">
            <div class="stats-card">
                <div class="stats-number" id="totalUsers">10</div>
                <div class="stats-label">Tổng người dùng</div>
            </div>
            <div class="stats-card">
                <div class="stats-number" id="activeUsers">8</div>
                <div class="stats-label">Đang hoạt động</div>
            </div>
            <div class="stats-card">
                <div class="stats-number" id="inactiveUsers">1</div>
                <div class="stats-label">Không hoạt động</div>
            </div>
            <div class="stats-card">
                <div class="stats-number" id="lockedUsers">1</div>
                <div class="stats-label">Bị khóa</div>
            </div>
        </div>

        <!-- Search and Filter Section -->
        <div class="search-filter-section">
            <div class="row g-3">
                <div class="col-lg-6">
                    <label class="form-label fw-semibold">Tìm kiếm</label>
                    <div class="search-box">
                        <input type="text" id="searchInput" placeholder="Nhập tên, username, email..." class="form-control">
                        <i class="fas fa-search search-icon"></i>
                    </div>
                </div>
                <div class="col-lg-6">
                    <label class="form-label fw-semibold">Bộ lọc</label>
                    <div class="filter-section">
                        <select class="filter-select" id="statusFilter">
                            <option value="">Tất cả trạng thái</option>
                            <option value="active">Đang hoạt động</option>
                            <option value="inactive">Không hoạt động</option>
                            <option value="locked">Bị khóa</option>
                        </select>
                        <select class="filter-select" id="roleFilter">
                            <option value="">Tất cả vai trò</option>
                            <option value="QUAN_TRI_VIEN">Quản trị viên</option>
                            <option value="TRUONG_PHONG_CSVC">Trưởng phòng CSVC</option>
                            <option value="NHAN_VIEN_CSVC">Nhân viên CSVC</option>
                            <option value="KY_THUAT_VIEN">Kỹ thuật viên</option>
                            <option value="GIAO_VIEN">Giáo viên</option>
                        </select>
                        <button class="btn btn-outline-primary" onclick="clearFilters()">
                            <i class="fas fa-times"></i> Xóa bộ lọc
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Users Table -->
        <div class="users-table-container">
            <div class="table-header">
                <h5 class="table-title">
                    <i class="fas fa-list me-2"></i>
                    Danh sách người dùng
                </h5>
                <div class="d-flex gap-2">
                    <button class="btn btn-outline-light btn-sm" title="Làm mới" onclick="refreshUserList()">
                        <i class="fas fa-sync-alt"></i>
                    </button>
                    <button class="btn btn-outline-light btn-sm" title="Xuất Excel" onclick="exportUsers()">
                        <i class="fas fa-file-excel"></i>
                    </button>
                </div>
            </div>

            <div class="table-responsive">
                <table class="users-table table">
                    <thead>
                    <tr>
                        <th width="5%">#</th>
                        <th width="25%">Thông tin người dùng</th>
                        <th width="15%">Email</th>
                        <th width="12%">Số điện thoại</th>
                        <th width="20%">Vai trò</th>
                        <th width="10%">Trạng thái</th>
                        <th width="13%">Thao tác</th>
                    </tr>
                    </thead>
                    <tbody id="usersTableBody">
                    <!-- Sample data -->
                    <tr>
                        <td>1</td>
                        <td>
                            <div class="user-info">
                                <div class="user-avatar">AD</div>
                                <div>
                                    <div class="user-name">Nguyễn Văn Admin</div>
                                    <div class="user-username">@admin</div>
                                </div>
                            </div>
                        </td>
                        <td>admin@truonghoc.edu.vn</td>
                        <td>0901234567</td>
                        <td>
                            <div class="role-badges">
                                <span class="role-badge">Quản trị viên</span>
                            </div>
                        </td>
                        <td>
                            <span class="status-badge status-active">Hoạt động</span>
                        </td>
                        <td>
                            <div class="action-buttons">
                                <button class="action-btn view" title="Xem chi tiết" onclick="viewUser('/nguoi-dung/chi-tiet-nguoi-dung.html')">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="action-btn edit" title="Chỉnh sửa" onclick="editUser('/nguoi-dung/chinh-sua-nguoi-dung.html')">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="action-btn lock" title="Khóa tài khoản" onclick="lockUser('/nguoi-dung/xoa-nguoi-dung.html')">
                                    <i class="fas fa-lock"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>2</td>
                        <td>
                            <div class="user-info">
                                <div class="user-avatar">HT</div>
                                <div>
                                    <div class="user-name">Nguyễn Văn Hiệu</div>
                                    <div class="user-username">@hieupho.nguyen</div>
                                </div>
                            </div>
                        </td>
                        <td>hieupho@truonghoc.edu.vn</td>
                        <td>0901234568</td>
                        <td>
                            <div class="role-badges">
                                <span class="role-badge">Hiệu trưởng</span>
                            </div>
                        </td>
                        <td>
                            <span class="status-badge status-active">Hoạt động</span>
                        </td>
                        <td>
                            <div class="action-buttons">
                                <button class="action-btn view" title="Xem chi tiết" onclick="viewUser('/nguoi-dung/chi-tiet-nguoi-dung.html')">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="action-btn edit" title="Chỉnh sửa" onclick="editUser('/nguoi-dung/chinh-sua-nguoi-dung.html')">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="action-btn lock" title="Khóa tài khoản" onclick="lockUser('/nguoi-dung/xoa-nguoi-dung.html')">
                                    <i class="fas fa-lock"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>3</td>
                        <td>
                            <div class="user-info">
                                <div class="user-avatar">TP</div>
                                <div>
                                    <div class="user-name">Trần Thị Phòng</div>
                                    <div class="user-username">@phong.tran</div>
                                </div>
                            </div>
                        </td>
                        <td>phongcsvc@truonghoc.edu.vn</td>
                        <td>0901234569</td>
                        <td>
                            <div class="role-badges">
                                <span class="role-badge">Trưởng phòng CSVC</span>
                            </div>
                        </td>
                        <td>
                            <span class="status-badge status-active">Hoạt động</span>
                        </td>
                        <td>
                            <div class="action-buttons">
                                <button class="action-btn view" title="Xem chi tiết" onclick="viewUser('/nguoi-dung/chi-tiet-nguoi-dung.html')">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="action-btn edit" title="Chỉnh sửa" onclick="editUser('/nguoi-dung/chinh-sua-nguoi-dung.html')">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="action-btn lock" title="Khóa tài khoản" onclick="lockUser('/nguoi-dung/xoa-nguoi-dung.html')">
                                    <i class="fas fa-lock"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>

            <!-- Pagination -->
            <div class="pagination-container">
                <div class="d-flex justify-content-between align-items-center">
                    <div class="pagination-info">
                        Hiển thị <strong>1-10</strong> trong tổng số <strong>10</strong> người dùng
                    </div>
                    <nav>
                        <ul class="pagination mb-0">
                            <li class="page-item disabled">
                                <a class="page-link" href="#" tabindex="-1">Trước</a>
                            </li>
                            <li class="page-item active">
                                <a class="page-link" href="#">1</a>
                            </li>
                            <li class="page-item">
                                <a class="page-link" href="#">2</a>
                            </li>
                            <li class="page-item">
                                <a class="page-link" href="#">3</a>
                            </li>
                            <li class="page-item">
                                <a class="page-link" href="#">Sau</a>
                            </li>
                        </ul>
                    </nav>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Notification Container -->
<div id="notificationContainer" class="position-fixed top-0 end-0 p-3" style="z-index: 9999;"></div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<!-- Custom JavaScript -->
<script src="/js/dashboard.js"></script>
<script>
    // User Management JavaScript
    let currentPage = 1;
    let pageSize = 10;
    let totalUsers = 0;
    let currentSearch = '';
    let currentStatusFilter = '';
    let currentRoleFilter = '';
    let allUsers = [];

    // Initialize page
    document.addEventListener('DOMContentLoaded', function() {
        loadUsers();
        setupEventListeners();
    });

    function setupEventListeners() {
        // Search input
        const searchInput = document.getElementById('searchInput');
        const statusFilter = document.getElementById('statusFilter');
        const roleFilter = document.getElementById('roleFilter');

        // Debounce search
        let searchTimeout;
        searchInput.addEventListener('input', function() {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(() => {
                currentSearch = this.value.trim();
                currentPage = 1;
                loadUsers();
            }, 500);
        });

        // Filter changes
        statusFilter.addEventListener('change', function() {
            currentStatusFilter = this.value;
            currentPage = 1;
            loadUsers();
        });

        roleFilter.addEventListener('change', function() {
            currentRoleFilter = this.value;
            currentPage = 1;
            loadUsers();
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey || e.metaKey) {
                switch(e.key) {
                    case 'f':
                        e.preventDefault();
                        searchInput.focus();
                        break;
                    case 'n':
                        e.preventDefault();
                        window.location.href = '/nguoi-dung/them-moi';
                        break;
                }
            }
        });
    }

    async function loadUsers() {
        try {
            showLoadingState();

            // Simulated API call - replace with actual API
            const response = await simulateApiCall();

            if (response.success) {
                allUsers = response.data;
                renderUsersTable(response.data);
                updatePagination(response.pagination);
                updateStats(response.stats);
            } else {
                showError('Không thể tải danh sách người dùng');
            }
        } catch (error) {
            console.error('Error loading users:', error);
            showError('Có lỗi xảy ra khi tải danh sách người dùng');
        } finally {
            hideLoadingState();
        }
    }

    function simulateApiCall() {
        return new Promise((resolve) => {
            setTimeout(() => {
                const users = [
                    {
                        id: 1,
                        tenDangNhap: 'admin',
                        hoVaTen: 'Nguyễn Văn Admin',
                        email: 'admin@truonghoc.edu.vn',
                        soDienThoai: '0901234567',
                        vaiTro: ['Quản trị viên'],
                        trangThai: 'active',
                        ngayTao: '2023-01-01',
                        lanDangNhapCuoi: '2024-07-30 14:00'
                    },
                    {
                        id: 2,
                        tenDangNhap: 'hieupho.nguyen',
                        hoVaTen: 'Nguyễn Văn Hiệu',
                        email: 'hieupho@truonghoc.edu.vn',
                        soDienThoai: '0901234568',
                        vaiTro: ['Hiệu trưởng'],
                        trangThai: 'active',
                        ngayTao: '2023-01-01',
                        lanDangNhapCuoi: '2024-07-29 16:30'
                    },
                    {
                        id: 3,
                        tenDangNhap: 'phong.tran',
                        hoVaTen: 'Trần Thị Phòng',
                        email: 'phongcsvc@truonghoc.edu.vn',
                        soDienThoai: '0901234569',
                        vaiTro: ['Trưởng phòng CSVC'],
                        trangThai: 'active',
                        ngayTao: '2023-01-01',
                        lanDangNhapCuoi: '2024-07-30 09:15'
                    },
                    {
                        id: 4,
                        tenDangNhap: 'duc.le',
                        hoVaTen: 'Lê Văn Đức',
                        email: 'duc.csvc@truonghoc.edu.vn',
                        soDienThoai: '0901234570',
                        vaiTro: ['Nhân viên CSVC'],
                        trangThai: 'active',
                        ngayTao: '2023-02-01',
                        lanDangNhapCuoi: '2024-07-30 08:45'
                    },
                    {
                        id: 5,
                        tenDangNhap: 'mai.pham',
                        hoVaTen: 'Phạm Thị Mai',
                        email: 'mai.csvc@truonghoc.edu.vn',
                        soDienThoai: '0901234571',
                        vaiTro: ['Nhân viên CSVC'],
                        trangThai: 'inactive',
                        ngayTao: '2023-02-01',
                        lanDangNhapCuoi: '2024-07-25 17:20'
                    },
                    {
                        id: 6,
                        tenDangNhap: 'thanh.vo',
                        hoVaTen: 'Võ Minh Thành',
                        email: 'thanh.kt@truonghoc.edu.vn',
                        soDienThoai: '0901234572',
                        vaiTro: ['Kỹ thuật viên'],
                        trangThai: 'active',
                        ngayTao: '2023-03-01',
                        lanDangNhapCuoi: '2024-07-30 10:30'
                    },
                    {
                        id: 7,
                        tenDangNhap: 'hung.dao',
                        hoVaTen: 'Đào Công Hùng',
                        email: 'hung.kt@truonghoc.edu.vn',
                        soDienThoai: '0901234573',
                        vaiTro: ['Kỹ thuật viên'],
                        trangThai: 'locked',
                        ngayTao: '2023-03-01',
                        lanDangNhapCuoi: '2024-07-28 15:45'
                    },
                    {
                        id: 8,
                        tenDangNhap: 'linh.nguyen',
                        hoVaTen: 'Nguyễn Thị Linh',
                        email: 'linh.gv@truonghoc.edu.vn',
                        soDienThoai: '0901234574',
                        vaiTro: ['Giáo viên'],
                        trangThai: 'active',
                        ngayTao: '2023-04-01',
                        lanDangNhapCuoi: '2024-07-30 07:20'
                    }
                ];

                // Apply filters
                let filteredUsers = users;

                if (currentSearch) {
                    filteredUsers = filteredUsers.filter(user =>
                        user.hoVaTen.toLowerCase().includes(currentSearch.toLowerCase()) ||
                        user.tenDangNhap.toLowerCase().includes(currentSearch.toLowerCase()) ||
                        user.email.toLowerCase().includes(currentSearch.toLowerCase())
                    );
                }

                if (currentStatusFilter) {
                    filteredUsers = filteredUsers.filter(user => user.trangThai === currentStatusFilter);
                }

                if (currentRoleFilter) {
                    filteredUsers = filteredUsers.filter(user =>
                        user.vaiTro.some(role => role.includes(currentRoleFilter))
                    );
                }

                // Pagination
                const startIndex = (currentPage - 1) * pageSize;
                const endIndex = startIndex + pageSize;
                const paginatedUsers = filteredUsers.slice(startIndex, endIndex);

                resolve({
                    success: true,
                    data: paginatedUsers,
                    pagination: {
                        currentPage: currentPage,
                        pageSize: pageSize,
                        totalItems: filteredUsers.length,
                        totalPages: Math.ceil(filteredUsers.length / pageSize)
                    },
                    stats: {
                        total: users.length,
                        active: users.filter(u => u.trangThai === 'active').length,
                        inactive: users.filter(u => u.trangThai === 'inactive').length,
                        locked: users.filter(u => u.trangThai === 'locked').length
                    }
                });
            }, 500);
        });
    }

    function renderUsersTable(users) {
        const tbody = document.getElementById('usersTableBody');

        if (users.length === 0) {
            tbody.innerHTML = `
            <tr>
                <td colspan="7">
                    <div class="empty-state">
                        <i class="fas fa-users"></i>
                        <h5>Không tìm thấy người dùng</h5>
                        <p>Thử thay đổi điều kiện tìm kiếm hoặc bộ lọc</p>
                    </div>
                </td>
            </tr>
        `;
            return;
        }

        tbody.innerHTML = users.map((user, index) => {
            const startIndex = (currentPage - 1) * pageSize;
            const rowNumber = startIndex + index + 1;
            const avatar = getInitials(user.hoVaTen);
            const statusClass = getStatusClass(user.trangThai);
            const statusText = getStatusText(user.trangThai);

            return `
            <tr>
                <td>${rowNumber}</td>
                <td>
                    <div class="user-info">
                        <div class="user-avatar">${avatar}</div>
                        <div>
                            <div class="user-name">${user.hoVaTen}</div>
                            <div class="user-username">@${user.tenDangNhap}</div>
                        </div>
                    </div>
                </td>
                <td>${user.email}</td>
                <td>${user.soDienThoai || '-'}</td>
                <td>
                    <div class="role-badges">
                        ${user.vaiTro.map(role => `<span class="role-badge">${role}</span>`).join('')}
                    </div>
                </td>
                <td>
                    <span class="status-badge ${statusClass}">${statusText}</span>
                </td>
                <td>
                    <div class="action-buttons">
                        <button class="action-btn view" title="Xem chi tiết" onclick="viewUser(${user.id})">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="action-btn edit" title="Chỉnh sửa" onclick="editUser(${user.id})">
                            <i class="fas fa-edit"></i>
                        </button>
                        ${user.trangThai === 'locked' ?
                `<button class="action-btn edit" title="Mở khóa" onclick="unlockUser(${user.id})">
                                <i class="fas fa-unlock"></i>
                            </button>` :
                `<button class="action-btn lock" title="Khóa tài khoản" onclick="lockUser(${user.id})">
                                <i class="fas fa-lock"></i>
                            </button>`
            }
                        ${user.tenDangNhap !== 'admin' ?
                `<button class="action-btn delete" title="Xóa" onclick="deleteUser(${user.id})">
                                <i class="fas fa-trash"></i>
                            </button>` : ''
            }
                    </div>
                </td>
            </tr>
        `;
        }).join('');
    }

    function updatePagination(pagination) {
        const paginationInfo = document.querySelector('.pagination-info');
        const startItem = (pagination.currentPage - 1) * pagination.pageSize + 1;
        const endItem = Math.min(pagination.currentPage * pagination.pageSize, pagination.totalItems);

        paginationInfo.innerHTML = `
        Hiển thị <strong>${startItem}-${endItem}</strong> trong tổng số <strong>${pagination.totalItems}</strong> người dùng
    `;

        // Update pagination controls (simplified)
        const paginationContainer = document.querySelector('.pagination');
        if (paginationContainer) {
            // Generate pagination HTML based on pagination object
            // This is a simplified version - you can enhance it
        }
    }

    function updateStats(stats) {
        document.getElementById('totalUsers').textContent = stats.total;
        document.getElementById('activeUsers').textContent = stats.active;
        document.getElementById('inactiveUsers').textContent = stats.inactive;
        document.getElementById('lockedUsers').textContent = stats.locked;
    }

    function getInitials(fullName) {
        return fullName.split(' ').map(name => name.charAt(0)).join('').substring(0, 2).toUpperCase();
    }

    function getStatusClass(status) {
        const classes = {
            'active': 'status-active',
            'inactive': 'status-inactive',
            'locked': 'status-locked'
        };
        return classes[status] || 'status-inactive';
    }

    function getStatusText(status) {
        const texts = {
            'active': 'Hoạt động',
            'inactive': 'Không hoạt động',
            'locked': 'Bị khóa'
        };
        return texts[status] || 'Không xác định';
    }

    function showLoadingState() {
        const tbody = document.getElementById('usersTableBody');
        tbody.innerHTML = `
        <tr>
            <td colspan="7" class="text-center py-5">
                <div class="loading-spinner"></div>
                <div class="mt-2">Đang tải dữ liệu...</div>
            </td>
        </tr>
    `;
    }

    function hideLoadingState() {
        // Loading state will be replaced by actual data
    }

    function showError(message) {
        showNotification(message, 'error');
    }

    function clearFilters() {
        document.getElementById('searchInput').value = '';
        document.getElementById('statusFilter').value = '';
        document.getElementById('roleFilter').value = '';

        currentSearch = '';
        currentStatusFilter = '';
        currentRoleFilter = '';
        currentPage = 1;

        loadUsers();
    }

    function refreshUserList() {
        const button = event.target.closest('button');
        const originalHTML = button.innerHTML;
        button.innerHTML = '<i class="fas fa-sync-alt fa-spin"></i>';
        button.disabled = true;

        setTimeout(() => {
            loadUsers();
            button.innerHTML = originalHTML;
            button.disabled = false;
            showNotification('Danh sách đã được làm mới', 'success');
        }, 1000);
    }

    function exportUsers() {
        showNotification('Đang xuất dữ liệu...', 'info');

        // Simulate export
        setTimeout(() => {
            const csvContent = generateCSV(allUsers);
            downloadCSV(csvContent, 'danh-sach-nguoi-dung.csv');
            showNotification('Xuất dữ liệu thành công', 'success');
        }, 1500);
    }

    function generateCSV(users) {
        const headers = ['STT', 'Họ và tên', 'Tên đăng nhập', 'Email', 'Số điện thoại', 'Vai trò', 'Trạng thái'];
        const rows = users.map((user, index) => [
            index + 1,
            user.hoVaTen,
            user.tenDangNhap,
            user.email,
            user.soDienThoai || '',
            user.vaiTro.join(', '),
            getStatusText(user.trangThai)
        ]);

        return [headers, ...rows].map(row => row.join(',')).join('\n');
    }

    function downloadCSV(content, filename) {
        const blob = new Blob([content], { type: 'text/csv;charset=utf-8;' });
        const link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        link.download = filename;
        link.click();
        URL.revokeObjectURL(link.href);
    }

    // User Actions
    function viewUser(userId) {
        window.location.href = `/nguoi-dung/chi-tiet-nguoi-dung/${userId}`;
    }

    function editUser(userId) {
        window.location.href = `/nguoi-dung/chinh-sua-nguoi-dung/${userId}`;
    }

    function deleteUser(userId) {
        const user = allUsers.find(u => u.id === userId);
        if (!user) return;

        if (confirm(`Bạn có chắc chắn muốn xóa người dùng "${user.hoVaTen}"?\nThao tác này không thể hoàn tác.`)) {
            showNotification('Đang xóa người dùng...', 'info');

            // Simulate API call
            setTimeout(() => {
                showNotification(`Đã xóa người dùng "${user.hoVaTen}" thành công`, 'success');
                loadUsers();
            }, 1000);
        }
    }

    function lockUser(userId) {
        const user = allUsers.find(u => u.id === userId);
        if (!user) return;

        if (confirm(`Bạn có chắc chắn muốn khóa tài khoản "${user.hoVaTen}"?`)) {
            showNotification('Đang khóa tài khoản...', 'info');

            // Simulate API call
            setTimeout(() => {
                showNotification(`Đã khóa tài khoản "${user.hoVaTen}" thành công`, 'success');
                loadUsers();
            }, 1000);
        }
    }

    function unlockUser(userId) {
        const user = allUsers.find(u => u.id === userId);
        if (!user) return;

        if (confirm(`Bạn có chắc chắn muốn mở khóa tài khoản "${user.hoVaTen}"?`)) {
            showNotification('Đang mở khóa tài khoản...', 'info');

            // Simulate API call
            setTimeout(() => {
                showNotification(`Đã mở khóa tài khoản "${user.hoVaTen}" thành công`, 'success');
                loadUsers();
            }, 1000);
        }
    }

    // Pagination functions
    function goToPage(page) {
        currentPage = page;
        loadUsers();
    }

    function previousPage() {
        if (currentPage > 1) {
            currentPage--;
            loadUsers();
        }
    }

    function nextPage() {
        // You would need to check against totalPages from the API response
        currentPage++;
        loadUsers();
    }
</script>
</body>
</html>